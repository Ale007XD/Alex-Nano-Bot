{
  "spec_version": "1.1",
  "name": "skill_self_improve",
  "description": "–°–∏—Å—Ç–µ–º–Ω—ã–π –Ω–∞–≤—ã–∫ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ò–ò-—É–ø—Ä–∞–≤–ª—è–µ–º–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –Ω–∞–≤—ã–∫–æ–≤ —Å —Ä—É—á–Ω—ã–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
  "category": "self_improvement",
  "author": "Alex-Nano-Bot Team",
  "version": "1.0.0",
  "commands": ["/improve_skill", "/apply_proposal", "/reject_proposal"],
  "security_level": "admin_only",

  "llm_prompt": {
    "SKILL_NAME": "skill_self_improve",
    "SKILL_DESCRIPTION": "–ü–æ–∑–≤–æ–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —É–ª—É—á—à–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏ —Å –ø–æ–º–æ—â—å—é –ò–ò: –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å, –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ.",
    "SKILL_CATEGORY": "system",
    "SKILL_VERSION": "1.0.0",
    "SKILL_AUTHOR": "Alex-Nano-Bot Team",
    "SKILL_COMMANDS": ["/improve_skill", "/apply_proposal", "/reject_proposal"],
    "TARGET_FILE_PATH": "skills/system/skill_self_improve.py",
    "REQUIREMENTS": [
      "aiogram >=3.0",
      "httpx",
      "asyncio",
      "os",
      "re",
      "time",
      "logging"
    ],
    "CONTEXT": {
      "PROJECT_ROOT": "/app",
      "SKILLS_DIR": "skills/custom",
      "PROPOSALS_DIR": "skills/proposals",
      "ADMIN_ONLY": true,
      "USE_CODER_MODEL": true,
      "HOT_RELOAD_SUPPORTED": true
    },
    "INSTRUCTIONS": "–°–æ–∑–¥–∞–π –ø–æ–ª–Ω—ã–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π Python-–º–æ–¥—É–ª—å –¥–ª—è Telegram-–±–æ—Ç–∞ –Ω–∞ aiogram 3.x, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ç—Ä–∏ –∫–æ–º–∞–Ω–¥—ã:\n\n1. `/improve_skill <name> [–æ–ø–∏—Å–∞–Ω–∏–µ]` ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –Ω–∞–≤—ã–∫–∞ –∏–∑ `skills/custom/{name}.py`, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞–∫ `skills/proposals/{name}_v2.py`, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—Å.\n2. `/apply_proposal <name>` ‚Äî –∑–∞–º–µ–Ω—è–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –Ω–∞–≤—ã–∫ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º, —Å–æ–∑–¥–∞—ë—Ç .bak-—Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é, –≤—ã–∑—ã–≤–∞–µ—Ç reload_skills().\n3. `/reject_proposal <name>` ‚Äî —É–¥–∞–ª—è–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.\n\n–ü—Ä–∞–≤–∏–ª–∞:\n- –¢–æ–ª—å–∫–æ –¥–ª—è ADMIN_IDS (–∏—Å–ø–æ–ª—å–∑—É–π is_admin() –∏–∑ app.utils.helpers).\n- –í—Å–µ –ø—É—Ç–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞.\n- –ò—Å–ø–æ–ª—å–∑—É–π get_llm_response() –∏–∑ app.core.llm_client —Å CODER_MODEL.\n- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –∏—Å–∫–ª—é—á–µ–Ω–∏—è, –ª–æ–≥–∏—Ä—É–π –æ—à–∏–±–∫–∏.\n- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π eval/exec/os.system/subprocess.\n- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å (async/await).\n- –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—ã–∑–æ–≤–∏ await reload_skills().\n- –í–æ–∑–≤—Ä–∞—â–∞–π –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ Telegram.\n\n–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è:\n- –ò–º–ø–æ—Ä—Ç—ã\n- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—É—Ç–µ–π\n- –¢—Ä–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–æ–º–∞–Ω–¥ (message handlers)\n- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)\n\n–ù–µ –≤–∫–ª—é—á–∞–π –±–ª–æ–∫ if __name__ == '__main__'.\n–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û —á–∏—Å—Ç—ã–π Python-–∫–æ–¥ –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π."
  },

  "example_output_code": "import os\nimport re\nimport time\nimport logging\nfrom aiogram import Router, F\nfrom aiogram.types import Message\nfrom app.core.config import settings\nfrom app.core.llm_client import get_llm_response\nfrom app.utils.helpers import is_admin\nfrom app.core.skills_loader import reload_skills\n\nlogger = logging.getLogger(__name__)\n\nSKILLS_DIR = \"skills/custom\"\nPROPOSALS_DIR = \"skills/proposals\"\n\nos.makedirs(PROPOSALS_DIR, exist_ok=True)\n\nrouter = Router(name=\"self_improve_skill\")\n\n@router.message(F.text.startswith(\"/improve_skill\"))\nasync def improve_skill_handler(message: Message):\n    if not is_admin(message.from_user.id):\n        await message.reply(\"üîí –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–ª—É—á—à–∞—Ç—å –Ω–∞–≤—ã–∫–∏.\")\n        return\n\n    text = message.text.strip()\n    if text == \"/improve_skill\":\n        await message.reply(\"UsageId: /improve_skill <skill_name> [–æ–ø–∏—Å–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏—è]\")\n        return\n\n    after_cmd = text[len(\"/improve_skill\"):].strip()\n    if \" \" in after_cmd:\n        skill_name, improvement_desc = after_cmd.split(\" \", 1)\n    else:\n        skill_name = after_cmd\n        improvement_desc = \"–£–ª—É—á—à–∏ –∫–æ–¥: —Å–¥–µ–ª–∞–π –µ–≥–æ –Ω–∞–¥—ë–∂–Ω–µ–µ, —á–∏—â–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ.\"\n\n    skill_path = os.path.join(SKILLS_DIR, f\"{skill_name}.py\")\n    if not os.path.exists(skill_path):\n        await message.reply(f\"‚ùå –ù–∞–≤—ã–∫ `{skill_name}` –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ `{SKILLS_DIR}/`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.\")\n        return\n\n    try:\n        with open(skill_path, \"r\", encoding=\"utf-8\") as f:\n            current_code = f.read()\n\n        prompt = f\"\"\"–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç Python-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫. –£–ª—É—á—à–∏ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥ –Ω–∞–≤—ã–∫–∞ Telegram-–±–æ—Ç–∞.\n\n–ü—Ä–∞–≤–∏–ª–∞:\n- –°–æ—Ö—Ä–∞–Ω—è–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É: SKILL_NAME, SKILL_DESCRIPTION –∏ —Ç.–¥.\n- –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–ª–∏ —Ç–µ, —á—Ç–æ –µ—Å—Ç—å –≤ requirements.txt (aiogram, httpx, asyncio).\n- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π eval, exec, os.system.\n- –ö–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º (async/await).\n- –î–æ–±–∞–≤—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫.\n- –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –ø–æ–ª–Ω—ã–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥ –Ω–∞ Python, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π.\n\n–û–ø–∏—Å–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏—è: {improvement_desc}\n\n–¢–µ–∫—É—â–∏–π –∫–æ–¥:\n```python\n{current_code}\n```\n\n–£–ª—É—á—à—ë–Ω–Ω—ã–π –∫–æ–¥:\n```python\n\"\"\"\n\n        improved_code = await get_llm_response(\n            prompt,\n            model=settings.CODER_MODEL,\n            temperature=0.2,\n            max_tokens=2000\n        )\n\n        match = re.search(r\"```python\\s*(.*?)\\s*```\", improved_code, re.DOTALL | re.IGNORECASE)\n        if match:\n            improved_code = match.group(1).strip()\n        else:\n            improved_code = improved_code.strip()\n\n        compile(improved_code, \"<generated>\", \"exec\")\n\n        proposal_path = os.path.join(PROPOSALS_DIR, f\"{skill_name}_v2.py\")\n        with open(proposal_path, \"w\", encoding=\"utf-8\") as f:\n            f.write(improved_code)\n\n        await message.reply(\n            f\"‚úÖ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –Ω–∞–≤—ã–∫–∞ `{skill_name}` —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ.\\n\"\n            f\"–§–∞–π–ª: `{proposal_path}`\\n\\n\"\n            f\"–û—Ç–ø—Ä–∞–≤—å:\\n`/apply_proposal {skill_name}` ‚Äî —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å\\n\"\n            f\"`/reject_proposal {skill_name}` ‚Äî —á—Ç–æ–±—ã –æ—Ç–∫–ª–æ–Ω–∏—Ç—å\"\n        )\n        logger.info(f\"Proposal created for skill: {skill_name}\")\n\n    except SyntaxError as e:\n        await message.reply(f\"‚ùå –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É:\\n`{e}`\")\n    except Exception as e:\n        await message.reply(f\"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–ª—É—á—à–µ–Ω–∏—è:\\n`{str(e)}`\")\n        logger.exception(\"Error in /improve_skill\")\n\n\n@router.message(F.text.startswith(\"/apply_proposal\"))\nasync def apply_proposal_handler(message: Message):\n    if not is_admin(message.from_user.id):\n        await message.reply(\"üîí –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω.\")\n        return\n\n    skill_name = message.text.replace(\"/apply_proposal\", \"\").strip()\n    if not skill_name:\n        await message.reply(\"UsageId: /apply_proposal <skill_name>\")\n        return\n\n    proposal_path = os.path.join(PROPOSALS_DIR, f\"{skill_name}_v2.py\")\n    target_path = os.path.join(SKILLS_DIR, f\"{skill_name}.py\")\n\n    if not os.path.exists(proposal_path):\n        await message.reply(f\"‚ùå –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è `{skill_name}` –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.\")\n        return\n\n    if not os.path.exists(target_path):\n        await message.reply(f\"‚ö†Ô∏è –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –Ω–∞–≤—ã–∫ `{skill_name}` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.\")\n        return\n\n    backup_path = f\"{target_path}.bak.{int(time.time())}\"\n    os.rename(target_path, backup_path)\n    os.rename(proposal_path, target_path)\n    await reload_skills()\n\n    await message.reply(\n        f\"‚úÖ –ù–∞–≤—ã–∫ `{skill_name}` –æ–±–Ω–æ–≤–ª—ë–Ω!\\n\"\n        f\"–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è: `{backup_path}`\\n\"\n        f\"–ò—Å–ø–æ–ª—å–∑—É–π `/rollback {skill_name}` –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫.\"\n    )\n\n\n@router.message(F.text.startswith(\"/reject_proposal\"))\nasync def reject_proposal_handler(message: Message):\n    skill_name = message.text.replace(\"/reject_proposal\", \"\").strip()\n    if not skill_name:\n        await message.reply(\"UsageId: /reject_proposal <skill_name>\")\n        return\n\n    proposal_path = os.path.join(PROPOSALS_DIR, f\"{skill_name}_v2.py\")\n    if os.path.exists(proposal_path):\n        os.remove(proposal_path)\n        await message.reply(f\"üóëÔ∏è –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è `{skill_name}` —É–¥–∞–ª–µ–Ω–æ.\")\n    else:\n        await message.reply(\"‚ùå –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.\")\n",

  "rag_document": "–®–∞–±–ª–æ–Ω —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –Ω–∞–≤—ã–∫–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–∞–º–æ—É–ª—É—á—à–µ–Ω–∏—è –±–æ—Ç–∞ —á–µ—Ä–µ–∑ –ò–ò. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å, –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –Ω–∞–≤—ã–∫–æ–≤ —Å —Ä—É—á–Ω—ã–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∏ hot-reload. –ö–æ–º–∞–Ω–¥—ã: /improve_skill, /apply_proposal, /reject_proposal. –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ ADMIN_IDS. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç CODER_MODEL –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞. –ù–∞–≤—ã–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ skills/system/, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚Äî –≤ skills/proposals/.",

  "chroma_metadata": {
    "type": "skill_template",
    "name": "skill_self_improve",
    "category": "self_improvement",
    "version": "1.0.0",
    "author": "Alex-Nano-Bot Team",
    "commands": ["/improve_skill", "/apply_proposal", "/reject_proposal"],
    "security_level": "admin_only",
    "file_path": "skills/system/skill_self_improve.py",
    "json_spec_id": "skill_self_improve_v1",
    "created_at": "2026-02-10"
  },

  "auto_load_script": "import os\nimport json\nimport logging\nfrom app.core.memory import get_memory_client\n\nasync def load_self_improve_template_to_memory():\n    \"\"\"–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —à–∞–±–ª–æ–Ω self-improve –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ø–∞–º—è—Ç—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞.\"\"\"\n    try:\n        # –ü—É—Ç—å –∫ —ç—Ç–æ–º—É JSON-—Ñ–∞–π–ª—É\n        spec_path = \"data/skill_templates/skill_self_improve.json\"\n        if not os.path.exists(spec_path):\n            logging.warning(f\"Self-improve template not found at {spec_path}\")\n            return\n\n        with open(spec_path, \"r\", encoding=\"utf-8\") as f:\n            spec = json.load(f)\n\n        client = await get_memory_client()\n\n        # –ü—Ä–æ–≤–µ—Ä–∏–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ\n        existing = await client.query(\n            query_texts=[\"self-improve skill template\"],\n            n_results=1,\n            where={\"name\": \"skill_self_improve\"}\n        )\n\n        if existing['ids'] and existing['ids'][0]:\n            logging.info(\"Self-improve template already in memory.\")\n            return\n\n        await client.add(\n            ids=[spec[\"chroma_metadata\"][\"json_spec_id\"]],\n            documents=[spec[\"rag_document\"]],\n            metadatas=[spec[\"chroma_metadata\"]]\n        )\n        logging.info(\"‚úÖ Self-improve skill template loaded into RAG memory.\")\n\n    except Exception as e:\n        logging.error(f\"Failed to load self-improve template: {e}\", exc_info=True)\n"
}
